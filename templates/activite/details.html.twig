{% extends 'base.html.twig' %}

{% block title %}Activity Details - {{ activite.nomAct }}{% endblock %}

{% block body %}
<!-- Include header, navigation, etc., from your base template or other includes -->
{% include 'ClientHome/header.html.twig' with {'page_title': 'Activity Details'} %}

<section class="activity-details">
    <div class="container">
        <div class="activity-details__top">
            <p>The activity starts: {{ activite.datedebut|date('l, M d, Y') }}</p>
            <h3>{{ activite.nomAct }}</h3>
        </div>
        <div class="row">
            <div class="col-lg-8">
                <div class="activity-details__content">
                    <img src="{{ asset('uploads/posters/' ~ activite.posterurl) }}" alt="Poster for {{ activite.nomAct }}" style="width: 760px; height: 565px;" class="activity-details__image">
                    <ul class="list-unstyled">
                        <li><strong>Type:</strong> {{ activite.typeAct }}</li>
                        <li><strong>Start Date:</strong> {{ activite.datedebut|date('l, M d, Y') }}</li>
                        <li><strong>End Date:</strong> {{ activite.datefin|date('l, M d, Y') }}</li>
                        <li><strong>Location:</strong> <i class="fa fa-map-marker"></i> {{ activite.lieu }}</li>
                        <li><strong>Number of Places:</strong> {{ activite.nbrePlaces }}</li>
                    </ul>
                    <a href="{{ path('activite_gallery') }}" class="btn btn-primary">Back to Activities</a>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="activity-details__qr">
                    <span class="qr-label">Scan Here</span>
                    <img id="qrCodeImage" src="{{ path('generate_qr_code', {'activityId': activite.idActivite}) }}" alt="QR Code" class="img-fluid">
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block javascripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const activityId = {{ activite.idActivite }};
        const qrCodeUrl = `/qr-code/${activityId}`;
        const qrCodeImage = document.getElementById('qrCodeImage');
        fetch(qrCodeUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load QR code image');
                }
                return response.blob();
            })
            .then(blob => {
                const imageUrl = URL.createObjectURL(blob);
                qrCodeImage.src = imageUrl;
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });
</script>
{% endblock %}
