{% extends 'base.html.twig' %}

{% block title %}Activite Collections - YourSite{% endblock %}


{% block body %}
<link rel="stylesheet" href="{{ asset('css/gallery.css') }}">
    {% include 'ClientHome/header.html.twig' with {'page_title': 'Activities'} %}
    <input type="text" id="search-input" placeholder="Search activities by name..." autocomplete="on">
    <div id="search-results"></div>

    <section class="collection-grid collection-masonary">
        <div class="container">
            <div class="collection-grid__top">
                <div class="block-title text-left">
                    <p>Gallery of Activities</p>
                    <h3>Explore the Activities</h3>
                </div>
            </div>
            <div class="row high-gutter filter-layout masonary-layout">
                {% if activites is not empty %}
                    {% for activite in activites %}
                        <div class="col-lg-4 col-md-6 filter-item masonary-item {{ activite.typeAct|lower }}">
                            <div class="collection-grid__single">
                                <div class="image-container">
                                    <img src="{{ asset('uploads/posters/' ~ activite.posterurl) }}" alt="{{ activite.nomAct }}" width="300" height="300">
                                
                                    {% if activite.nomAct|lower == 'puzzle' %}
                                        <a href="{{ path('app_puzzle2') }}" class="btn btn-primary btn-participate">Participate</a>
                                    {% elseif activite.nomAct|lower == 'quiz' %}
                                        <a href="{{ path('quiz_question') }}" class="btn btn-primary btn-participate">Start Quiz</a>

                                    {% else %}
                                        <div class="overlay coming-soon">Coming Soon</div>
                                    {% endif %}
                                </div>
                                <div class="collection-grid__content">
                                    <h3><a href="{{ path('app_activite_show', {'idActivite': activite.idActivite}) }}">{{ activite.nomAct }}</a></h3>
                                    <p>{{ activite.typeAct }}</p>
                                 
                                     {{ activite.datedebut|date('l, M d, Y')}}
                                     <p> and it ends </p>
                                     {{activite.datefin|date('l, M d, Y')}}
                                                                         
                                      <a href="{{ path('activity_details', {'idActivite': activite.idActivite}) }}"><button class="bn30">details</button></a> 
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>No activities to display.</p>
                {% endif %}
            </div>
        </div>
    </section>
 
{% endblock %}
{% block javascripts %}
<script>
 document.addEventListener('DOMContentLoaded', function() {
    const inputField = document.getElementById('search-input');
    const resultsContainer = document.getElementById('search-results');
    let timeout = null;
    inputField.addEventListener('input', function() {
        clearTimeout(timeout);
        const searchTerm = inputField.value.trim();
        timeout = setTimeout(() => {
            if (searchTerm.length > 2) {
                fetch('{{ path('app_activite_search') }}?query=' + encodeURIComponent(searchTerm))
                    .then(response => response.json())
                    .then(data => {
                        resultsContainer.innerHTML = '';
                        data.activites.forEach(activite => {
                            resultsContainer.innerHTML += `<p>${activite.nomAct}</p>`;
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        resultsContainer.innerHTML = '<p>Error loading activities.</p>';
                    });
            } else {
                resultsContainer.innerHTML = '';
            }
        }, 300); // Debounce time is 300ms
    });
});
</script>
{% endblock %}
